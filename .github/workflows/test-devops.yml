name: Test DevOps Setup Script

on:
  push:
    paths:
      - setup-devops.sh
      - .github/workflows/test-devops-install.yml
  pull_request:

jobs:
  test-install:
    name: Test installation on macOS
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Make setup script executable
        run: chmod +x ./setup-devops.sh

      - name: Run setup script (CLI only)
        run: ./setup-devops.sh --cli

      - name: Verify key CLI tools are installed
        run: |
          REQUIRED_TOOLS=(
            terraform
            terragrunt
            kubectl
            helm
            aws
            azure
            glab
            lazygit
          )

          for tool in "${REQUIRED_TOOLS[@]}"; do
            if ! command -v "$tool" &>/dev/null; then
              echo "❌ $tool not found in PATH!"
              exit 1
            else
              echo "✅ $tool is installed."
            fi
          done
